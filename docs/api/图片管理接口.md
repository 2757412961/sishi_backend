# 图片管理接口

# 1.1 v1.0/api/pictureFile [post]

### 描述

按照标签新建图片，上到nginx服务器。

先校验图片各属性是否符合要求，若符合则设置创建时间，保存到服务器上，并插入到数据库中，并返回新增图片实体。

### 参数

```json
form 表单中添加'pictureFile'字段

heads:{
    'Content-Type': 'multipart/form-data;'
}

body:{  
    "tagName": "String",
    ["pictureName": "String"]
}
```

- 参数说明:

  tagName，表示标签名，String，字符长度1-200，**必须**，唯一。

  pictureFile，表示图片文件，file，**必须**。

  pictureName，表示图片名称（带后缀），String，非必须。

-  输入示例:


```json
this.props.form.setFieldsValue({ 'pictureFile': file }); 

body:{  
    "tagName": "党史新学@中共一大@杭州@西溪",
    ["pictureName": "test.jpg"]
}
```

  ### 返回

1.创建成功，Status:201。返回所插入图片实体。

  ```json
{
    "pictureId": "d4094665-d7e0-4980-b750-b53ea65b9332",
    "pictureName": "5f57939d-0dcc-4011-8389-f445dbe52268-捕获.JPG",
    "pictureUrl": "http://192.168.137.1:8088/sishi/picture/5f57939d-0dcc-4011-8389-f445dbe52268-捕获.JPG",
    "createTime": 1615547986454
}
  ```

2.插入失败，Status: 400。校验失败有以下几种情况：

（1）请求不是表单格式，或者未上传文件对象；

  ```json
{
    "timestamp": "2021-03-12T13:12:24.875+0000",
    "status": 500,
    "error": "Internal Server Error",
    "message": "javax.validation.ValidationException: 请求不是表单格式，或者未上传文件对象",
    "path": "/v1.0/api/pictureFile"
}
  ```

（2）文件大小超出限制（1000MB）；

  ```json
{
    "timestamp": "2021-03-12T11:32:14.025+0000",
    "status": 500,
    "error": "Internal Server Error",
    "message": "Maximum upload size exceeded; nested exception is java.lang.IllegalStateException: org.apache.tomcat.util.http.fileupload.FileUploadBase$FileSizeLimitExceededException: The field pictureFile exceeds its maximum permitted size of 1048576 bytes.",
    "path": "/v1.0/api/pictureFile"
}
  ```

（3）标签参数为空；

```json
{
    "timestamp": "2021-03-12T11:32:45.133+0000",
    "status": 500,
    "error": "Internal Server Error",
    "message": "addPictureFileByTagName.arg1: tagName cannot be null",
    "path": "/v1.0/api/pictureFile"
}
```

（4）文件大小超过限制；

```json
{
    "timestamp": "2021-03-12T13:15:31.992+0000",
    "status": 500,
    "error": "Internal Server Error",
    "message": "Maximum upload size exceeded; nested exception is java.lang.IllegalStateException: org.apache.tomcat.util.http.fileupload.FileUploadBase$FileSizeLimitExceededException: The field pictureFile exceeds its maximum permitted size of 1048576 bytes.",
    "path": "/v1.0/api/pictureFile"
}
```



# 1.2 v1.0/api/pictures [get]

### 描述

查询图片列表。

### 参数

输入示例:

```
url:v1.0/api/pictures
```

###  返回

1.查询成功，Status: 200。

```json
[
    {
        "pictureId": "d4094665-d7e0-4980-b750-b53ea65b9332",
        "pictureName": "5f57939d-0dcc-4011-8389-f445dbe52268-捕获.JPG",
        "pictureUrl": "http://192.168.137.1:8088/sishi/picture/5f57939d-0dcc-4011-8389-f445dbe52268-捕获.JPG",
        "createTime": 1615547986454
    },
    {
        "pictureId": "d5b98d23-a40d-4a60-a2de-cc6a3b6d8c50",
        "pictureName": "0894c7ea-6844-458c-af75-d77d52c7a1fa-01 Radioactive.m4a",
        "pictureUrl": "http://192.168.137.1:8088/sishi/picture/0894c7ea-6844-458c-af75-d77d52c7a1fa-01 Radioactive.m4a",
        "createTime": 1615548696654
    }
]
```

# 1.3 v1.0/api/picture/{pictureId} [get]

### 描述

根据ID获取图片详情。

先判断pictureID是否为36位，若是则从数据库中获取指定ID的图片内容。

### 参数

```json
path:{
  "pictureId":string, 必须, 长度36
 }
```

* 参数说明：
  pictureId必须是36位的字符串

* 输入示例:

```
url:v1.0/api/picture/3172dea1-2c6d-41d0-8848-da6f33fd23a8
```

###  返回

1.查询成功，Status: 200，返回图片内容。

```json
{
    "pictureId": "3172dea1-2c6d-41d0-8848-da6f33fd23a8",
    "pictureName": "3b7a6083-6c88-40bf-86b0-4d08c21d4926-捕获.JPG",
    "pictureUrl": "http://192.168.137.1:8088/sishi/picture/3b7a6083-6c88-40bf-86b0-4d08c21d4926-捕获.JPG",
    "createTime": 1615548458606
}
```

2.查询失败，Status：500，id长度不符合要求，必须为36。pictureId length should be 36；

```json
{
    "timestamp": "2021-03-12T13:02:27.870+0000",
    "status": 500,
    "error": "Internal Server Error",
    "message": "getPictureById.arg0: pictureId length should be 36",
    "path": "/v1.0/api/picture/d33be120-3923-4469-a07c-8fb56f2edc660"
}
```

# 1.4 v1.0/api/pictures/tagName [get]

### 描述

按照标签查询图片列表。

### 参数

```
query {
    "tagName": "String",
}
```

* 参数说明：
  tagName，表示标签名，String，字符长度1-200，**必须**，唯一。

* 输入示例:

```
url:v1.0/api/pictures/tagName?tagName=党史新学@中共一大
```

###  返回

1.查询成功，Status: 200。

```json
[
    {
        "pictureId": "d4094665-d7e0-4980-b750-b53ea65b9332",
        "pictureName": "5f57939d-0dcc-4011-8389-f445dbe52268-捕获.JPG",
        "pictureUrl": "http://192.168.137.1:8088/sishi/picture/5f57939d-0dcc-4011-8389-f445dbe52268-捕获.JPG",
        "createTime": 1615547986454
    }
]
```

  2.查询失败，Status: 500。参数校验失败，校验失败情况：

（1）标签参数为空；

  ```json
{
    "timestamp": "2021-03-12T11:32:45.133+0000",
    "status": 500,
    "error": "Internal Server Error",
    "message": "addPictureFileByTagName.arg1: tagName cannot be null",
    "path": "/v1.0/api/pictureFile"
}
  ```

（2）标签不存在；

```json
{
    "timestamp": "2021-03-12T13:29:53.072+0000",
    "status": 500,
    "error": "Internal Server Error",
    "message": "javax.validation.ValidationException: tagName '党史新学@中共一大@杭州@西溪1' does not exist!",
    "path": "/v1.0/api/pictureFile"
}
```

# 1.5 v1.0/api/picture/{pictureId}/tagName/{tagName} [DELETE]

### 描述

根据标签名和资源ID删除一个图片。

先判断指定ID的图片是否存在且ID长度为36，再判断标签表中是否存在该标签，若存在则从数据库删除指定ID的图片，并返回消息体显示删除成功。

### 参数

```json
path:{
  "pictureId": "String",
  "tagName": "String"    
 }
```

* 参数说明：
  pictureId为图片ID，为36位UUID字符串。
  
  tagName，表示标签名，String，字符长度1-200，**必须**，唯一。
  
* 输入示例:

```
url:/v1.0/api/picture/1e96b9d3-183d-406e-ab30-d8759baca6f6/tagName/党史新学@中共一大
```

### 返回

1.删除成功，Status: 200。返回图片id显示删除成功

```json
{
    "pictureId": "d5b98d23-a40d-4a60-a2de-cc6a3b6d8c50"
}
```

2.删除失败

（1）Status：500，id长度不符合要求，必须为36。pictureId length should be 36；

```json
{
    "timestamp": "2021-03-12T12:45:26.905+0000",
    "status": 500,
    "error": "Internal Server Error",
    "message": "deletePictureByTagName.arg0: pictureId length should be 36",
    "path": "/v1.0/api/picture/1e96b9d3-183d-406e-ab30-d8759baa6f6/tagName/%E5%85%9A%E5%8F%B2%E6%96%B0%E5%AD%A6@%E4%B8%AD%E5%85%B1%E4%B8%80%E5%A4%A7"
}
```

（2）标签和资源关联记录不存在；

```json
{
    "timestamp": "2021-03-12T13:22:20.846+0000",
    "status": 500,
    "error": "Internal Server Error",
    "message": "tag resource record does not exist!",
    "path": "/v1.0/api/picture/d5b98d23-a40d-4a60-a2de-cc6a3b6d8c50/tagName/%E5%85%9A%E5%8F%B2%E6%96%B0%E5%AD%A6@%E4%B8%AD%E5%85%B1%E4%B8%80%E5%A4%A7@%E6%9D%AD%E5%B7%9E@%E8%A5%BF"
}
```

